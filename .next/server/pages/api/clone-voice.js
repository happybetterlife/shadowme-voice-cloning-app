"use strict";(()=>{var e={};e.id=923,e.ids=[923],e.modules={5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6762:(e,o)=>{Object.defineProperty(o,"M",{enumerable:!0,get:function(){return function e(o,t){return t in o?o[t]:"then"in o&&"function"==typeof o.then?o.then(o=>e(o,t)):"function"==typeof o&&"default"===t?o:void 0}}})},7858:(e,o,t)=>{t.r(o),t.d(o,{config:()=>g,default:()=>v,routeModule:()=>h});var i={};t.r(i),t.d(i,{config:()=>u,default:()=>d});var n=t(9947),a=t(2706),l=t(6762),s=t(4594);let c=process.env.ELEVENLABS_API_KEY||"sk_a44152702031b3af9f1a87072171fc9993fdbfb477fba26c",r=new Map;async function d(e,o){if("POST"!==e.method)return o.status(405).json({error:"Method not allowed"});try{console.log("\uD83C\uDFA4 Voice cloning request received..."),console.log("\uD83D\uDCDD Request body keys:",Object.keys(e.body));let{text:t="Hello, how are you today?",audioData:i,sessionId:n}=e.body;if(console.log("\uD83D\uDCDD Text received:",t),console.log("\uD83C\uDFB5 Audio data present:",!!i),console.log("\uD83C\uDFB5 Audio data type:",typeof i),console.log("\uD83C\uDD94 Session ID:",n),!i)return console.log("‚ùå No audio data provided, using default voice"),await p(t,o);if(n){let e=r.get(n);if(e&&Date.now()-e.lastUsed<18e5){console.log("‚ö° Ï∫êÏãúÎêú ÏùåÏÑ± Î∞úÍ≤¨! Ï¶âÏãú TTS ÏÉùÏÑ±:",e.voiceId);let i=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${e.voiceId}`,{method:"POST",headers:{"xi-api-key":c,"Content-Type":"application/json"},body:JSON.stringify({text:t,model_id:"eleven_multilingual_v2",voice_settings:{stability:.7,similarity_boost:.8,style:.5,use_speaker_boost:!0}})});if(i.ok){e.lastUsed=Date.now(),r.set(n,e);let t=await i.arrayBuffer();return o.setHeader("Content-Type","audio/mpeg"),o.setHeader("Content-Disposition",'attachment; filename="cached_cloned_voice.mp3"'),console.log("‚úÖ Ï∫êÏãúÎêú ÏùåÏÑ±ÏúºÎ°ú TTS ÏôÑÎ£å (Ï¥àÍ≥†ÏÜç)"),o.send(Buffer.from(t))}console.warn("‚ö†Ô∏è Ï∫êÏãúÎêú ÏùåÏÑ±ÏúºÎ°ú TTS Ïã§Ìå®, ÏùåÏÑ± Ïû¨ÏÉùÏÑ± ÌïÑÏöî"),r.delete(n)}else if(e){console.log("\uD83D\uDDD1Ô∏è ÎßåÎ£åÎêú Ï∫êÏãú ÏùåÏÑ± ÏÇ≠Ï†ú:",n),r.delete(n);try{await fetch(`https://api.elevenlabs.io/v1/voices/${e.voiceId}`,{method:"DELETE",headers:{"xi-api-key":c}})}catch(e){console.warn("ÏùåÏÑ± Ï†ïÎ¶¨ Ïã§Ìå®:",e)}}}let a=Buffer.from(i.split(",")[1],"base64");console.log("\uD83D\uDCC1 Audio data received, size:",a.length),console.log("\uD83E\uDDEC Creating voice clone with ElevenLabs...");let l=new FormData;l.append("name",`user_voice_${Date.now()}`),l.append("description","User voice for pronunciation learning");let d=new Blob([a],{type:"audio/webm"});l.append("files",d,"recording.webm");let u=await fetch("https://api.elevenlabs.io/v1/voices/add",{method:"POST",headers:{"xi-api-key":c},body:l});if(!u.ok){let e=await u.text();if(console.error("‚ùå Voice cloning failed:",e),e.includes("voice_limit_reached")){console.log("\uD83E\uDDF9 Voice limit reached, attempting to clean up old voices..."),await f(),console.log("\uD83D\uDD04 Retrying voice cloning after cleanup...");let e=await fetch("https://api.elevenlabs.io/v1/voices/add",{method:"POST",headers:{"xi-api-key":c},body:l});if(e.ok){let i=(await e.json()).voice_id;console.log("‚úÖ Voice cloned successfully after cleanup! Voice ID:",i);let n=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${i}`,{method:"POST",headers:{"xi-api-key":c,"Content-Type":"application/json"},body:JSON.stringify({text:t,model_id:"eleven_multilingual_v2",voice_settings:{stability:.7,similarity_boost:.8,style:.5,use_speaker_boost:!0}})});if(n.ok){let e=await n.arrayBuffer();try{await fetch(`https://api.elevenlabs.io/v1/voices/${i}`,{method:"DELETE",headers:{"xi-api-key":c}}),console.log("\uD83D\uDDD1Ô∏è Temporary voice cleaned up immediately")}catch(e){console.warn("Failed to delete voice:",e)}return o.setHeader("Content-Type","audio/mpeg"),o.setHeader("Content-Disposition",'attachment; filename="cloned_voice.mp3"'),o.send(Buffer.from(e))}}}return await p(t,o)}let v=(await u.json()).voice_id;console.log("‚úÖ Voice cloned successfully! Voice ID:",v),n?(r.set(n,{voiceId:v,createdAt:Date.now(),lastUsed:Date.now(),sampleText:t}),console.log("\uD83D\uDCBE ÏÑ∏ÏÖò ÏùåÏÑ± Ï∫êÏãúÏóê Ï†ÄÏû•:",n,"->",v),console.log("\uD83D\uDCCA ÌòÑÏû¨ Ï∫êÏãúÎêú ÏÑ∏ÏÖòÎì§:",Array.from(r.keys())),(0,s.cacheVoiceClone)(n,v,t)):console.warn("‚ö†Ô∏è sessionIdÍ∞Ä ÏóÜÏñ¥ÏÑú Ï∫êÏãúÏóê Ï†ÄÏû•ÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§!"),console.log("\uD83D\uDDE3Ô∏è Generating speech with cloned voice...");let g=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${v}`,{method:"POST",headers:{"xi-api-key":c,"Content-Type":"application/json"},body:JSON.stringify({text:t,model_id:"eleven_multilingual_v2",voice_settings:{stability:.7,similarity_boost:.8,style:.5,use_speaker_boost:!0}})});if(!g.ok){let e=await g.text();console.error("‚ùå TTS with cloned voice failed:",e);try{await fetch(`https://api.elevenlabs.io/v1/voices/${v}`,{method:"DELETE",headers:{"xi-api-key":c}})}catch(e){console.warn("Failed to delete voice:",e)}return await p(t,o)}let h=await g.arrayBuffer();return console.log("\uD83C\uDF89 Voice cloning completed successfully!"),console.log("\uD83D\uDCBE ÏùåÏÑ± Ï∫êÏãúÏóê Î≥¥Í¥ÄÎê® (30Î∂Ñ ÌõÑ ÏûêÎèô Ï†ïÎ¶¨)"),o.setHeader("Content-Type","audio/mpeg"),o.setHeader("Content-Disposition",'inline; filename="cloned_voice.mp3"'),o.setHeader("Access-Control-Allow-Origin","*"),o.setHeader("Accept-Ranges","bytes"),o.send(Buffer.from(h))}catch(t){return console.error("\uD83D\uDCA5 Voice cloning error:",t),await p(e.body?.text||"Hello, how are you today?",o)}}async function p(e,o){try{console.log("\uD83D\uDD04 Using default voice fallback...");let t=await fetch("https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM",{method:"POST",headers:{"xi-api-key":c,"Content-Type":"application/json"},body:JSON.stringify({text:e,model_id:"eleven_monolingual_v1",voice_settings:{stability:.7,similarity_boost:.8}})});if(t.ok){let e=await t.arrayBuffer();return o.setHeader("Content-Type","audio/mpeg"),o.setHeader("Content-Disposition",'inline; filename="fallback_voice.mp3"'),o.setHeader("Access-Control-Allow-Origin","*"),o.setHeader("Accept-Ranges","bytes"),o.send(Buffer.from(e))}{let e=await t.text();console.error("‚ùå Fallback voice generation failed:",e)}}catch(e){console.error("\uD83D\uDCA5 Fallback voice generation failed:",e)}return o.status(500).json({error:"All voice generation methods failed"})}async function f(){try{console.log("\uD83D\uDD0D Fetching current voices...");let e=await fetch("https://api.elevenlabs.io/v1/voices",{headers:{"xi-api-key":c}});if(e.ok){let o=(await e.json()).voices.filter(e=>e.name.startsWith("user_voice_")&&"cloned"===e.category);for(let e of(console.log(`üéØ Found ${o.length} user voices to clean up`),o.slice(0,-2)))try{await fetch(`https://api.elevenlabs.io/v1/voices/${e.voice_id}`,{method:"DELETE",headers:{"xi-api-key":c}}),console.log(`üóëÔ∏è Deleted old voice: ${e.name}`)}catch(o){console.warn(`Failed to delete voice ${e.name}:`,o)}console.log("‚úÖ Cleanup completed")}}catch(e){console.error("‚ùå Cleanup failed:",e)}}setInterval(function(){let e=Date.now(),o=[];for(let[t,i]of r)e-i.lastUsed>18e5&&(o.push(t),fetch(`https://api.elevenlabs.io/v1/voices/${i.voiceId}`,{method:"DELETE",headers:{"xi-api-key":c}}).catch(e=>console.warn("ÏùåÏÑ± ÏÇ≠Ï†ú Ïã§Ìå®:",e)));o.forEach(e=>{r.delete(e),console.log("\uD83D\uDDD1Ô∏è ÎßåÎ£åÎêú ÏÑ∏ÏÖò Ï†ïÎ¶¨:",e)}),o.length>0&&console.log(`‚úÖ ${o.length}Í∞ú ÎßåÎ£åÎêú ÏÑ∏ÏÖò Ï†ïÎ¶¨ ÏôÑÎ£å`)},6e5);let u={api:{bodyParser:{sizeLimit:"10mb"}}},v=(0,l.M)(i,"default"),g=(0,l.M)(i,"config"),h=new n.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/clone-voice",pathname:"/api/clone-voice",bundlePath:"",filename:""},userland:i})},4594:(e,o,t)=>{t.r(o),t.d(o,{cacheVoiceClone:()=>s,config:()=>c,default:()=>l});let i=process.env.ELEVENLABS_API_KEY||"sk_a44152702031b3af9f1a87072171fc9993fdbfb477fba26c",n="21m00Tcm4TlvDq8ikWAM",a=new Map;async function l(e,o){if("POST"!==e.method)return o.status(405).json({error:"Method not allowed"});try{console.log("\uD83C\uDFAF Speech generation request received...");let{text:t,sessionId:l,useClonedVoice:s=!1}=e.body;console.log("\uD83D\uDCDD Text:",t),console.log("\uD83C\uDD94 Session ID:",l),console.log("\uD83C\uDFAD Use cloned voice:",s);let c=n;if(s&&l){console.log("\uD83D\uDD0D Ï∫êÏãúÎêú ÏùåÏÑ± Ï∞æÎäî Ï§ë... sessionId:",l),console.log("\uD83D\uDCCA ÌòÑÏû¨ Ï∫êÏãúÎêú ÏÑ∏ÏÖòÎì§:",Array.from(a.keys()));let e=a.get(l);e?(c=e.voiceId,console.log("‚ö° Ï∫êÏãúÎêú ÌÅ¥Î°úÎãù ÏùåÏÑ± ÏÇ¨Ïö©:",c)):(console.log("‚ö†Ô∏è ÏÑ∏ÏÖòÏóê Ï∫êÏãúÎêú ÏùåÏÑ± ÏóÜÏùå, Í∏∞Î≥∏ ÏùåÏÑ± ÏÇ¨Ïö© (Î®ºÏ†Ä ÏÉòÌîå ÎÖπÏùå ÌïÑÏöî)"),console.log("\uD83D\uDD11 ÏöîÏ≤≠Îêú sessionId:",l),console.log("\uD83D\uDDC2Ô∏è Ï∫êÏãúÏóê ÏûàÎäî sessionIdÎì§:",Array.from(a.keys())))}else console.log("‚ùå useClonedVoice:",s,", sessionId:",l);let r=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${c}`,{method:"POST",headers:{"xi-api-key":i,"Content-Type":"application/json"},body:JSON.stringify({text:t,model_id:c===n?"eleven_monolingual_v1":"eleven_multilingual_v2",voice_settings:{stability:.7,similarity_boost:.8,style:.5,use_speaker_boost:c!==n}})});if(!r.ok){let e=await r.text();throw console.error("‚ùå TTS generation failed:",e),Error("TTS generation failed")}let d=await r.arrayBuffer();return o.setHeader("Content-Type","audio/mpeg"),o.setHeader("Content-Disposition",'inline; filename="speech.mp3"'),o.setHeader("Access-Control-Allow-Origin","*"),o.setHeader("Accept-Ranges","bytes"),o.send(Buffer.from(d))}catch(e){return console.error("\uD83D\uDCA5 Speech generation error:",e),o.status(500).json({error:"Speech generation failed"})}}function s(e,o,t){a.set(e,{voiceId:o,createdAt:Date.now(),sampleText:t}),console.log(`üíæ Cached voice clone for session ${e}: ${o}`)}let c={api:{bodyParser:{sizeLimit:"10mb"}}}},2706:(e,o)=>{var t;Object.defineProperty(o,"A",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE"}(t||(t={}))},9947:(e,o,t)=>{e.exports=t(5600)}};var o=require("../../webpack-api-runtime.js");o.C(e);var t=o(o.s=7858);module.exports=t})();