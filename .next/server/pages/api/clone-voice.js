"use strict";(()=>{var e={};e.id=923,e.ids=[923],e.modules={5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6762:(e,o)=>{Object.defineProperty(o,"M",{enumerable:!0,get:function(){return function e(o,t){return t in o?o[t]:"then"in o&&"function"==typeof o.then?o.then(o=>e(o,t)):"function"==typeof o&&"default"===t?o:void 0}}})},7858:(e,o,t)=>{t.r(o),t.d(o,{config:()=>h,default:()=>g,routeModule:()=>v});var i={};t.r(i),t.d(i,{config:()=>u,default:()=>d});var a=t(9947),n=t(2706),l=t(6762),s=t(4594);let c="sk_a44152702031b3af9f1a87072171fc9993fdbfb477fba26c",r=new Map;async function d(e,o){if("POST"!==e.method)return o.status(405).json({error:"Method not allowed"});try{console.log("\uD83C\uDFA4 Voice cloning request received..."),console.log("\uD83D\uDCDD Request body keys:",Object.keys(e.body));let{text:t="Hello, how are you today?",audioData:i,sessionId:a}=e.body;if(console.log("\uD83D\uDCDD Text received:",t),console.log("\uD83C\uDFB5 Audio data present:",!!i),console.log("\uD83C\uDFB5 Audio data type:",typeof i),console.log("\uD83C\uDFB5 Audio data length:",i?i.length:0),console.log("\uD83C\uDFB5 Audio data starts with:",i?i.substring(0,50):"N/A"),console.log("\uD83C\uDD94 Session ID:",a),!i||i.length<100)return console.log("âŒ No valid audio data provided, using default voice"),console.log("\uD83D\uDD0D Reason: audioData is",i?`too short (${i.length} chars)`:"missing"),await p(t,o);if(a){let e=r.get(a);if(e&&Date.now()-e.lastUsed<18e5){console.log("âš¡ ìºì‹œëœ ìŒì„± ë°œê²¬! ì¦‰ì‹œ TTS ìƒì„±:",e.voiceId);let i=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${e.voiceId}`,{method:"POST",headers:{"xi-api-key":c,"Content-Type":"application/json"},body:JSON.stringify({text:t,model_id:"eleven_multilingual_v2",voice_settings:{stability:.7,similarity_boost:.8,style:.5,use_speaker_boost:!0}})});if(i.ok){e.lastUsed=Date.now(),r.set(a,e);let t=await i.arrayBuffer();return o.setHeader("Content-Type","audio/mpeg"),o.setHeader("Content-Disposition",'attachment; filename="cached_cloned_voice.mp3"'),console.log("âœ… ìºì‹œëœ ìŒì„±ìœ¼ë¡œ TTS ì™„ë£Œ (ì´ˆê³ ì†)"),o.send(Buffer.from(t))}console.warn("âš ï¸ ìºì‹œëœ ìŒì„±ìœ¼ë¡œ TTS ì‹¤íŒ¨, ìŒì„± ìž¬ìƒì„± í•„ìš”"),r.delete(a)}else if(e){console.log("\uD83D\uDDD1ï¸ ë§Œë£Œëœ ìºì‹œ ìŒì„± ì‚­ì œ:",a),r.delete(a);try{await fetch(`https://api.elevenlabs.io/v1/voices/${e.voiceId}`,{method:"DELETE",headers:{"xi-api-key":c}})}catch(e){console.warn("ìŒì„± ì •ë¦¬ ì‹¤íŒ¨:",e)}}}let n=Buffer.from(i.split(",")[1],"base64");console.log("\uD83D\uDCC1 Audio data received, size:",n.length),console.log("\uD83E\uDDEC Creating voice clone with ElevenLabs...");let l=new FormData;l.append("name",`user_voice_${Date.now()}`),l.append("description","User voice for pronunciation learning");let d=new Blob([n],{type:"audio/webm"});l.append("files",d,"recording.webm");let u=await fetch("https://api.elevenlabs.io/v1/voices/add",{method:"POST",headers:{"xi-api-key":c},body:l});if(!u.ok){let e=await u.text();if(console.error("âŒ Voice cloning failed:",e),e.includes("voice_limit_reached")){console.log("\uD83E\uDDF9 Voice limit reached, attempting to clean up old voices..."),await f(),console.log("\uD83D\uDD04 Retrying voice cloning after cleanup...");let e=await fetch("https://api.elevenlabs.io/v1/voices/add",{method:"POST",headers:{"xi-api-key":c},body:l});if(e.ok){let i=(await e.json()).voice_id;console.log("âœ… Voice cloned successfully after cleanup! Voice ID:",i);let a=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${i}`,{method:"POST",headers:{"xi-api-key":c,"Content-Type":"application/json"},body:JSON.stringify({text:t,model_id:"eleven_multilingual_v2",voice_settings:{stability:.7,similarity_boost:.8,style:.5,use_speaker_boost:!0}})});if(a.ok){let e=await a.arrayBuffer();try{await fetch(`https://api.elevenlabs.io/v1/voices/${i}`,{method:"DELETE",headers:{"xi-api-key":c}}),console.log("\uD83D\uDDD1ï¸ Temporary voice cleaned up immediately")}catch(e){console.warn("Failed to delete voice:",e)}return o.setHeader("Content-Type","audio/mpeg"),o.setHeader("Content-Disposition",'attachment; filename="cloned_voice.mp3"'),o.send(Buffer.from(e))}}}return await p(t,o)}let g=(await u.json()).voice_id;console.log("âœ… Voice cloned successfully! Voice ID:",g),a?(r.set(a,{voiceId:g,createdAt:Date.now(),lastUsed:Date.now(),sampleText:t}),console.log("\uD83D\uDCBE ì„¸ì…˜ ìŒì„± ìºì‹œì— ì €ìž¥:",a,"->",g),console.log("\uD83D\uDCCA í˜„ìž¬ ìºì‹œëœ ì„¸ì…˜ë“¤:",Array.from(r.keys())),(0,s.cacheVoiceClone)(a,g,t)):console.warn("âš ï¸ sessionIdê°€ ì—†ì–´ì„œ ìºì‹œì— ì €ìž¥í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤!"),console.log("\uD83D\uDDE3ï¸ Generating speech with cloned voice...");let h=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${g}`,{method:"POST",headers:{"xi-api-key":c,"Content-Type":"application/json"},body:JSON.stringify({text:t,model_id:"eleven_multilingual_v2",voice_settings:{stability:.7,similarity_boost:.8,style:.5,use_speaker_boost:!0}})});if(!h.ok){let e=await h.text();console.error("âŒ TTS with cloned voice failed:",e);try{await fetch(`https://api.elevenlabs.io/v1/voices/${g}`,{method:"DELETE",headers:{"xi-api-key":c}})}catch(e){console.warn("Failed to delete voice:",e)}return await p(t,o)}let v=await h.arrayBuffer();return console.log("\uD83C\uDF89 Voice cloning completed successfully!"),console.log("\uD83D\uDCBE ìŒì„± ìºì‹œì— ë³´ê´€ë¨ (30ë¶„ í›„ ìžë™ ì •ë¦¬)"),o.setHeader("Content-Type","audio/mpeg"),o.setHeader("Content-Disposition",'inline; filename="cloned_voice.mp3"'),o.setHeader("Access-Control-Allow-Origin","*"),o.setHeader("Accept-Ranges","bytes"),o.send(Buffer.from(v))}catch(t){return console.error("\uD83D\uDCA5 Voice cloning error:",t),await p(e.body?.text||"Hello, how are you today?",o)}}async function p(e,o){try{console.log("\uD83D\uDD04 Using default voice fallback...");let t=await fetch("https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM",{method:"POST",headers:{"xi-api-key":c,"Content-Type":"application/json"},body:JSON.stringify({text:e,model_id:"eleven_monolingual_v1",voice_settings:{stability:.7,similarity_boost:.8}})});if(t.ok){let e=await t.arrayBuffer();return o.setHeader("Content-Type","audio/mpeg"),o.setHeader("Content-Disposition",'inline; filename="fallback_voice.mp3"'),o.setHeader("Access-Control-Allow-Origin","*"),o.setHeader("Accept-Ranges","bytes"),o.send(Buffer.from(e))}{let e=await t.text();console.error("âŒ Fallback voice generation failed:",e)}}catch(e){console.error("\uD83D\uDCA5 Fallback voice generation failed:",e)}return o.status(500).json({error:"All voice generation methods failed"})}async function f(){try{console.log("\uD83D\uDD0D Fetching current voices...");let e=await fetch("https://api.elevenlabs.io/v1/voices",{headers:{"xi-api-key":c}});if(e.ok){let o=(await e.json()).voices.filter(e=>e.name.startsWith("user_voice_")&&"cloned"===e.category);for(let e of(console.log(`ðŸŽ¯ Found ${o.length} user voices to clean up`),o.slice(0,-2)))try{await fetch(`https://api.elevenlabs.io/v1/voices/${e.voice_id}`,{method:"DELETE",headers:{"xi-api-key":c}}),console.log(`ðŸ—‘ï¸ Deleted old voice: ${e.name}`)}catch(o){console.warn(`Failed to delete voice ${e.name}:`,o)}console.log("âœ… Cleanup completed")}}catch(e){console.error("âŒ Cleanup failed:",e)}}setInterval(function(){let e=Date.now(),o=[];for(let[t,i]of r)e-i.lastUsed>18e5&&(o.push(t),fetch(`https://api.elevenlabs.io/v1/voices/${i.voiceId}`,{method:"DELETE",headers:{"xi-api-key":c}}).catch(e=>console.warn("ìŒì„± ì‚­ì œ ì‹¤íŒ¨:",e)));o.forEach(e=>{r.delete(e),console.log("\uD83D\uDDD1ï¸ ë§Œë£Œëœ ì„¸ì…˜ ì •ë¦¬:",e)}),o.length>0&&console.log(`âœ… ${o.length}ê°œ ë§Œë£Œëœ ì„¸ì…˜ ì •ë¦¬ ì™„ë£Œ`)},6e5);let u={api:{bodyParser:{sizeLimit:"10mb"}}},g=(0,l.M)(i,"default"),h=(0,l.M)(i,"config"),v=new a.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/clone-voice",pathname:"/api/clone-voice",bundlePath:"",filename:""},userland:i})},4594:(e,o,t)=>{t.r(o),t.d(o,{cacheVoiceClone:()=>l,config:()=>s,default:()=>n});let i="21m00Tcm4TlvDq8ikWAM",a=new Map;async function n(e,o){if("POST"!==e.method)return o.status(405).json({error:"Method not allowed"});try{console.log("\uD83C\uDFAF Speech generation request received...");let{text:t,sessionId:n,useClonedVoice:l=!1}=e.body;console.log("\uD83D\uDCDD Text:",t),console.log("\uD83C\uDD94 Session ID:",n),console.log("\uD83C\uDFAD Use cloned voice:",l);let s=i;if(l&&n){console.log("\uD83D\uDD0D ìºì‹œëœ ìŒì„± ì°¾ëŠ” ì¤‘... sessionId:",n),console.log("\uD83D\uDCCA í˜„ìž¬ ìºì‹œëœ ì„¸ì…˜ë“¤:",Array.from(a.keys()));let e=a.get(n);e?(s=e.voiceId,console.log("âš¡ ìºì‹œëœ í´ë¡œë‹ ìŒì„± ì‚¬ìš©:",s)):(console.log("âš ï¸ ì„¸ì…˜ì— ìºì‹œëœ ìŒì„± ì—†ìŒ, ê¸°ë³¸ ìŒì„± ì‚¬ìš© (ë¨¼ì € ìƒ˜í”Œ ë…¹ìŒ í•„ìš”)"),console.log("\uD83D\uDD11 ìš”ì²­ëœ sessionId:",n),console.log("\uD83D\uDDC2ï¸ ìºì‹œì— ìžˆëŠ” sessionIdë“¤:",Array.from(a.keys())))}else console.log("âŒ useClonedVoice:",l,", sessionId:",n);let c=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${s}`,{method:"POST",headers:{"xi-api-key":"sk_a44152702031b3af9f1a87072171fc9993fdbfb477fba26c","Content-Type":"application/json"},body:JSON.stringify({text:t,model_id:s===i?"eleven_monolingual_v1":"eleven_multilingual_v2",voice_settings:{stability:.7,similarity_boost:.8,style:.5,use_speaker_boost:s!==i}})});if(!c.ok){let e=await c.text();throw console.error("âŒ TTS generation failed:",e),Error("TTS generation failed")}let r=await c.arrayBuffer();return o.setHeader("Content-Type","audio/mpeg"),o.setHeader("Content-Disposition",'inline; filename="speech.mp3"'),o.setHeader("Access-Control-Allow-Origin","*"),o.setHeader("Accept-Ranges","bytes"),o.send(Buffer.from(r))}catch(e){return console.error("\uD83D\uDCA5 Speech generation error:",e),o.status(500).json({error:"Speech generation failed"})}}function l(e,o,t){a.set(e,{voiceId:o,createdAt:Date.now(),sampleText:t}),console.log(`ðŸ’¾ Cached voice clone for session ${e}: ${o}`)}let s={api:{bodyParser:{sizeLimit:"10mb"}}}},2706:(e,o)=>{var t;Object.defineProperty(o,"A",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE"}(t||(t={}))},9947:(e,o,t)=>{e.exports=t(5600)}};var o=require("../../webpack-api-runtime.js");o.C(e);var t=o(o.s=7858);module.exports=t})();